#!/bin/sh -e

export DESTDIR="$1"

patch -p1 < 0001-muon-will-try-to-use-iconv-even-though-its-not-neede.patch

: > fuzzing/meson.build

muon setup \
    -Dprefix=/usr \
    -Dlibexecdir=/usr/lib \
    -Dlibmount=disabled \
    -Dinstalled_tests=false \
    -Dman-pages=disabled \
    -Dtests=false \
    -Dlibelf=disabled \
    -Dnls=disabled \
    -Dsysprof=disabled \
    -Ddefault_library=both \
    -Dpkg_config_path=/usr/lib/pkgconfig \
    build

samu -C build
muon -C build install

rm -rf "$1/usr/bin/gdbus"
